# API를 활용한 Object Storage 실습

카카오 클라우드에서 제공하는 여러 API를 활용하여 Object Storage를 VM인스턴스 환경에서 활용해봅니다. CLI 환경에서 API 인증키를 발급받고 버킷 생성 및 상세 내용 조회, 파일관리 등 Object Storage를 활용할 수 있는 방법에 대한 실습입니다.

## 1. VM인스턴스 SSH 접속


1. 카카오 클라우드 콘솔 > 전체 서비스 > Virual Machine 접속
2. bastion 인스턴스의 우측 메뉴바 클릭 > SSH 연결 버튼 클릭
     - SSH 접속 명령어 복사(6. keyPair.pem 파일이 있는 경로에서 아래 명령어를 실행합니다.)
     - Keypair를 다운받아놓은 Downloads 폴더로 이동
     - 터미널 열기
     - 터미널에 명령어 붙여넣기

    ```bash
    cd {keyPair.pem 다운로드 위치}
    ```
    ```bash
    ssh -i keyPair.pem centos@{ip주소}
    ```

3. 데이터 출력을 위한 패키지 설치 - 명령어 입력
    ```bash
    sudo yum -y install epel-release jp
    ```

## 2. API 활용을 위한 인증토큰 발급


1. 초기에 진행했던 사용자 액세스 키 ID, 사용자 액세스 보안 키 클립보드 열기
2. 터미널 명령어 입력
    ```bash
    curl -i -X POST "https://iam.kakaoi.io/identity/v3/auth/tokens" -H "Content-Type: application/json" -d '{
        "auth": {
            "identity": {
                "methods": [
                    "application_credential"
                ],
                "application_credential": {
                    "id": "{사용자 액세스 키 ID}",
                    "secret": "{사용자 액세스 보안 키}"
                }
            }
        }
    }'
    ```
3. X-Subject-Token = API 인증 토큰 복사하기
    - 터미널 이용시 `ctrl + f`을 이용해 해당 값 찾기
4. Project ID 항목 복사해두기 
     - 이후 폴더 및 파일 관리 실습에서 사용

## 3. 버킷 생성 및 조회


1. 버킷 생성 - 터미널 명령어 입력
    ```bash
    curl --request PUT --location 'https://objectstorage.kr-central-2.kakaoi.io/v1_ext/bucket' \
    --header 'X-Auth-Token: {API인증 토큰}' \
    --header 'Content-Type: application/json' \
    --data '{
    "name": "bucket-test",
    "type": "STANDARD",
    "use_encryption": true,
    "encryption_configuration": {
        "type": "managed"
    }
    }'
    ```
2. 버킷 조회하기 - 터미널 명령어 입력
    ```bash
    curl --location --request GET 'https://objectstorage.kr-central-2.kakaoi.io/v1_ext/bucket/{bucket_name}' \
    --header 'X-Auth-Token: {API인증 토큰}' | jq '.'
    ```

## 4. 버킷 내 폴더 생성


1. 버킷 내 폴더 생성 - 터미널 명령어 입력
    ```bash
    curl --location --request PUT 'https://objectstorage.kr-central-2.kakaoi.io/v1/{프로젝트 ID}/bucket-test/text/' \
    --header 'X-Auth-Token: {API인증 토큰}' \
    --header 'Content-Type: application/directory' \
    --header 'X-Object-Meta-Company: kakao enterprise'
    ```
2. 카카오 클라우드 콘솔 > 전체 서비스 > Object Storage 접속
3. bucket-test 버킷 클릭
4. 내부에 text 폴더 생성된 것을 확인

## 5. 파일 생성 및 업로드

1. 버킷 내 파일 생성 - 터미널 명령어 입력
    ```bash
    curl --location --request PUT 'https://objectstorage.kr-central-2.kakaoi.io/v1/{프로젝트 ID}/bucket-test/text/index.txt' \
    --header 'X-Auth-Token: {API인증 토큰}' \
    --header 'Content-Type: text/plain' \
    --data '"I am a test file"'
    ```
2. 카카오 클라우드 콘솔 > 전체 서비스 > Object Storage 접속
3. bucket-test 버킷 클릭
4. text 폴더 클릭
    - index.txt. 파일 생성된 것을 확인

## 6. 생성된 파일 불러오기


1. 생성된 파일 불러오기 - 터미널 명령어 입력
    ```bash
    curl --location --request GET 'https://objectstorage.kr-central-2.kakaoi.io/v1/{프로젝트 ID}/bucket-test/text/index.txt' \
    --header 'X-Auth-Token: {API인증 토큰}'
    2. 'i am a test file' 메세지 출력 확인
    ```

## 7. 파일 삭제
1. 파일 삭제 - 터미널 명령어 입력
    ```bash
    curl --location --request DELETE 'https://objectstorage.kr-central-2.kakaoi.io/v1/{프로젝트 ID}/bucket-test/text/index.txt' \
    --header 'X-Auth-Token: {API인증 토큰}'
    ```
2. 카카오 클라우드 콘솔 > 전체 서비스 > Object Storage 접속
3. bucket-test 버킷 클릭
4. text 폴더 클릭
    - index.txt. 파일 삭제된 것을 확인



## 8. 버킷 삭제


1. 버킷 비우기 - 터미널 명령어 입력
     - 버킷 내 파일 및 폴더가 존재하지 않아야 가능합니다.
    ```bash
    curl --location --request DELETE 'https://objectstorage.kr-central-2.kakaoi.io/v1/{프로젝트 ID}/bucket-test/?dir-delete' \
    --header 'X-Auth-Token: {API인증 토큰}'
    ```
2. 카카오 클라우드 콘솔 > 전체 서비스 > Object Storage 접속
3. bucket-test 버킷 클릭
4. text 폴더 클릭
    - text 폴더 삭제된 것을 확인
5. 버킷 삭제하기 - 터미널 명령어 입력
    ```bash
    curl --location --request DELETE 'https://objectstorage.kr-central-2.kakaoi.io/v1_ext/bucket/bucket-test' \
    --header 'X-Auth-Token: {API인증토큰}'
    ```
6. 카카오 클라우드 콘솔 > 전체 서비스 > Object Storage 접속
7. bucket-test 버킷 삭제된 것을 확인